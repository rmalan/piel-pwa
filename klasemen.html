<!DOCTYPE html>
<html>
	<head>
		<!--Import Google Icon Font-->
		<link
			href="https://fonts.googleapis.com/icon?family=Material+Icons"
			rel="stylesheet"
		/>
		<!--Import materialize.css-->
		<link
			type="text/css"
			rel="stylesheet"
			href="css/materialize.min.css"
			media="screen,projection"
		/>
		<link type="text/css" rel="stylesheet" href="css/style.css" />

		<!--Let browser know website is optimized for mobile-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<link rel="shortcut icon" href="images/favicon.ico" />

		<title>PieL-PWA | Semua Tentang Premier League</title>
	</head>

	<body>
		<header>
			<nav class="purple darken-4">
				<div class="nav-wrapper container">
					<a href="#!" class="brand-logo">PieL</a>
					<a
						href="#"
						data-target="mobile-demo"
						class="sidenav-trigger"
					>
						<i class="material-icons">menu</i>
					</a>
					<ul class="right hide-on-med-and-down">
						<li><a href="index.html">Beranda</a></li>
						<li><a href="tim.html">Tim</a></li>
						<li><a href="klasemen.html">Klasemen</a></li>
						<li><a href="favorit.html">Favorit</a></li>
					</ul>

					<ul class="sidenav" id="mobile-demo">
						<li><a href="index.html">Beranda</a></li>
						<li><a href="tim.html">Tim</a></li>
						<li><a href="klasemen.html">Klasemen</a></li>
						<li><a href="favorit.html">Favorit</a></li>
					</ul>
				</div>
			</nav>
		</header>

		<main>
			<div class="container" id="body-content">
				<h1 class="center align">
					Klasemen Premier League
				</h1>
				<div class="divider"></div>
				<div class="row">
					<div class="standings-list">
						<div id="preload"></div>
						<table
							id="standings-table"
							class="responsive-table striped centered"
						>
							<thead>
								<tr>
									<th>#</th>
									<th>Badge</th>
									<th>Tim</th>
									<th>Bermain</th>
									<th>Menang</th>
									<th>Seri</th>
									<th>Kalah</th>
									<th>GF</th>
									<th>GA</th>
									<th>GD</th>
									<th>Poin</th>
								</tr>
							</thead>

							<tbody id="pl-standings"></tbody>
						</table>
					</div>
				</div>
			</div>
		</main>

		<footer class="page-footer purple darken-4">
			<div class="footer-copyright">
				<div class="container">
					2020 &#169; PieL
					<a class="grey-text text-lighten-4 right" href="#!"
						>GitHub</a
					>
				</div>
			</div>
		</footer>

		<!--JavaScript at end of body for optimized loading-->
		<script type="text/javascript" src="js/materialize.min.js"></script>
		<script type="text/javascript" src="js/script.js"></script>
		<script>
			let base_url = "https://api.football-data.org/v2/";

			// Blok kode yang akan di panggil jika fetch berhasil
			function status(response) {
				if (response.status !== 200) {
					console.log("Error : " + response.status);

					// Method reject() akan membuat blok catch terpanggil
					return Promise.reject(new Error(response.statusText));
				} else {
					// Mengubah suatu objek menjadi Promise agar bisa "di-then-kan"
					return Promise.resolve(response);
				}
			}

			// Blok kode untuk memparsing json menjadi array JavaScript
			function json(response) {
				return response.json();
			}

			// Blok kode untuk meng-handle kesalahan di blok catch
			function error(error) {
				// Parameter error berasal dari Promise.reject()
				console.log("Error : " + error);
			}

			// Block kode utk menampilkan pre-oad sebelum data dimuat
			function preloader() {
				let preload = `
                    <div class="center-align">
						<div class="preloader-wrapper big active">
							<div class="spinner-layer spinner-blue-only">
								<div class="circle-clipper left">
									<div class="circle"></div>
								</div>
								<div class="gap-patch">
									<div class="circle"></div>
								</div>
								<div class="circle-clipper right">
									<div class="circle"></div>
								</div>
							</div>
						</div>
					</div>
                `;

				// Menyisipkan preload
				document.getElementById("preload").innerHTML = preload;
			}

			// Blok kode untuk melakukan request data json
			function getStandings() {
				preloader();

				// Menyembunyikan tabel klasemen
				document
					.querySelector("#standings-table")
					.classList.add("hide");

				fetch(base_url + "competitions/2021/standings", {
					method: "GET",
					headers: new Headers({
						"X-Auth-Token": "f93b4249e66a4297bf2fd1af2a8d7e6a",
					}),
				})
					.then(status)
					.then(json)
					.then(function (data) {
						// Menyusun komponen klasemen
						let standings = "";
						data.standings[0].table.forEach((standing) => {
							standings += `
								<tr>
									<td>${standing.position}</td>
									<td><img src="${standing.team.crestUrl}" class="badge" alt="Badge ${standing.team.name}" /></td>
									<td>${standing.team.name}</td>
									<td>${standing.playedGames}</td>
									<td>${standing.won}</td>
									<td>${standing.draw}</td>
									<td>${standing.lost}</td>
									<td>${standing.goalsFor}</td>
									<td>${standing.goalsAgainst}</td>
									<td>${standing.goalDifference}</td>
									<td>${standing.points}</td>
								</tr>
							`;
						});
						// Menampilkan tabel klasemen
						document
							.querySelector("#standings-table")
							.classList.remove("hide");

						// Sisipkan komponen klasemen ke dalam elemen dengan id #pl-standings
						document.getElementById(
							"pl-standings"
						).innerHTML = standings;

						// Menghilangkan preload
						document.getElementById("preload").innerHTML = "";
					})
					.catch(error);
			}

			document.addEventListener("DOMContentLoaded", function () {
				getStandings();
			});
		</script>
	</body>
</html>
